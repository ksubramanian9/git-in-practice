<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Git in Practice â€” GitLab Setup</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { darkMode: 'class' }</script>

  <script>
    (function () {
      const stored = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = stored || (prefersDark ? 'dark' : 'light');
      if (theme === 'dark') document.documentElement.classList.add('dark');
    })();
  </script>

  <link rel="stylesheet" href="../assets/site.css" />
</head>

<body class="h-full bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100">

<header class="sticky top-0 z-40 border-b border-slate-200/70 bg-white/80 backdrop-blur dark:border-slate-800/70 dark:bg-slate-950/70">
  <div class="mx-auto max-w-screen-2xl px-4 sm:px-6 lg:px-8">
    <div class="flex h-14 items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <button id="btnMobileNav"
                class="lg:hidden inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold shadow-sm hover:bg-slate-50 dark:border-slate-800 dark:bg-slate-900 dark:hover:bg-slate-800"
                aria-label="Open navigation" aria-expanded="false">â˜°</button>

        <a href="../index.html" class="flex items-center gap-2 font-extrabold tracking-tight">
          <span class="inline-flex h-8 w-8 items-center justify-center rounded-xl bg-indigo-600 text-white shadow-soft">Gi</span>
          <span class="hidden sm:inline">Git in Practice</span>
        </a>

        <span class="hidden sm:inline text-slate-400 dark:text-slate-600">/</span>
        <span class="hidden sm:inline text-sm font-semibold text-slate-600 dark:text-slate-300">Platform</span>
      </div>

      <button id="btnTheme"
              class="inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold shadow-sm hover:bg-slate-50 dark:border-slate-800 dark:bg-slate-900 dark:hover:bg-slate-800"
              aria-label="Toggle dark mode">
        <span id="themeIcon" aria-hidden="true">ðŸŒ™</span>
        <span class="hidden sm:inline" id="themeLabel">Dark</span>
      </button>
    </div>
  </div>
</header>

<div class="mx-auto max-w-screen-2xl px-4 sm:px-6 lg:px-8">
  <div class="grid grid-cols-1 gap-6 py-6 lg:grid-cols-[280px_1fr]">
    <aside class="lg:sticky lg:top-20 lg:h-[calc(100vh-5rem)] lg:overflow-auto">
      <div id="mobileBackdrop" class="fixed inset-0 z-40 hidden bg-black/40 lg:hidden"></div>
      <div id="sidebarPanel"
           class="fixed left-0 top-14 z-50 hidden h-[calc(100vh-3.5rem)] w-[86vw] max-w-[320px] overflow-auto border-r border-slate-200 bg-white p-4 shadow-soft dark:border-slate-800 dark:bg-slate-950 lg:static lg:block lg:h-auto lg:w-auto lg:max-w-none lg:border lg:rounded-2xl lg:p-4 lg:shadow-none">
        <div data-include="../partials/sidebar.html"></div>
        <div class="mt-6 rounded-2xl border border-slate-200 bg-slate-50 p-4 text-xs text-slate-600 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-300">
          <div class="font-bold">Doc owner</div><div class="mt-1">Engineering Platform</div>
          <div class="mt-3 font-bold">Last reviewed</div><div class="mt-1">2025-05-12</div>
        </div>
      </div>
    </aside>

    <main class="min-w-0">
      <div class="mb-4 text-sm text-slate-500 dark:text-slate-400">
        <a href="../index.html" class="hover:text-slate-900 dark:hover:text-slate-100">Home</a>
        <span class="mx-2">/</span><span class="font-semibold text-slate-700 dark:text-slate-200">Platform</span>
        <span class="mx-2">/</span><span class="font-semibold text-slate-700 dark:text-slate-200">GitLab Setup</span>
      </div>

      <article class="rounded-2xl border border-slate-200 bg-white p-6 shadow-soft dark:border-slate-800 dark:bg-slate-950">
        <header class="mb-6">
          <h1 class="text-2xl font-extrabold tracking-tight sm:text-3xl">GitLab Setup</h1>
          <p class="mt-3 max-w-3xl text-slate-600 dark:text-slate-300">
            Standard GitLab project settings for protected branches, merge request approvals, and pipeline enforcement so delivery matches GitHub parity.
          </p>
        </header>

        <section class="space-y-10">
          <section>
            <h2 class="text-lg font-bold">Policy</h2>
            <ul class="mt-3 space-y-3 text-slate-700 dark:text-slate-200">
              <li><b>Must:</b> Protect <b>main</b>, <b>release/*</b>, and <b>hotfix/*</b> with Maintainer-only pushes.</li>
              <li><b>Must:</b> Require merge request approvals from CODEOWNERS groups and enforce successful pipelines before merge.</li>
              <li><b>Must:</b> Prevent <i>Merge when pipeline succeeds</i> overrides; block direct pushes to protected branches.</li>
              <li><b>Should:</b> Enable <i>Fast-forward merge</i> to keep linear history when possible.</li>
              <li><b>Must not:</b> Bypass approvals using admin override except under documented incident response.</li>
            </ul>
          </section>

          <section>
            <h2 class="text-lg font-bold">Project configuration checklist</h2>
            <ol class="mt-3 list-decimal space-y-3 pl-5 text-slate-700 dark:text-slate-200">
              <li>
                <div class="font-semibold">Protected branches</div>
                <ul class="mt-2 list-disc space-y-2 pl-5 text-sm">
                  <li>Protect <b>main</b> and active <b>release/*</b>; allow <i>Developers + Maintainers</i> to merge, but only <i>Maintainers</i> to push.</li>
                  <li>Require <i>Pipelines must succeed</i> and disallow <i>Allow force push</i>.</li>
                  <li>Disable <i>Allow to merge</i> for anyone who is not in the review rotation.</li>
                </ul>
              </li>
              <li>
                <div class="font-semibold">Merge request approvals</div>
                <ul class="mt-2 list-disc space-y-2 pl-5 text-sm">
                  <li>Create approval rules that map to CODEOWNERS paths and require at least one owner.</li>
                  <li>Set minimum approvals: one for low-risk changes, two for production-impacting services.</li>
                  <li>Enable <i>Reset approvals on new push</i> and block merge if discussions are unresolved.</li>
                </ul>
              </li>
              <li>
                <div class="font-semibold">Pipelines</div>
                <ul class="mt-2 list-disc space-y-2 pl-5 text-sm">
                  <li>Ensure default branch pipelines include build, test, lint, and security scanning stages.</li>
                  <li>Mark required jobs as <b>protected</b> so only runners with access tokens can execute deploy steps.</li>
                  <li>Use <code>rules:</code> to prevent skip-ci for protected branches and to block merge until required jobs pass.</li>
                </ul>
              </li>
              <li>
                <div class="font-semibold">Repository hygiene</div>
                <ul class="mt-2 list-disc space-y-2 pl-5 text-sm">
                  <li>Enable <i>Delete source branch</i> after merge and default to <i>Squash commits</i>.</li>
                  <li>Restrict <i>Push rules</i>: signed commits, deny secrets via regex, enforce commit message format.</li>
                  <li>Turn on security dashboards and dependency scanning in the group CI templates.</li>
                </ul>
              </li>
            </ol>
          </section>

          <section>
            <h2 class="text-lg font-bold">Setup procedure</h2>
            <ol class="mt-3 list-decimal space-y-3 pl-5 text-slate-700 dark:text-slate-200">
              <li>Go to <b>Settings â†’ Repository â†’ Protected branches</b>; add rules for <b>main</b> and <b>release/*</b> with <i>Developers + Maintainers</i> allowed to merge and <i>Maintainers</i> allowed to push.</li>
              <li>In <b>Settings â†’ Merge requests</b>, set <i>Pipelines must succeed</i>, enable <i>Fast-forward merge</i>, and require <i>Delete source branch</i>.</li>
              <li>Configure <b>Settings â†’ General â†’ Merge request approvals</b>: map CODEOWNERS groups, set approval counts, and enable <i>Remove all approvals when commits are added</i>.</li>
              <li>Update <code>.gitlab-ci.yml</code> to include the pipelines listed in <a class="link" href="./required-ci-checks.html">Required CI Checks</a> and mark deploy jobs as protected.</li>
              <li>Turn on <b>Security & Compliance</b> features (secret detection, dependency and container scanning) for all default branches.</li>
              <li>Validate that merge requests cannot merge with failing or skipped required jobs by opening a test MR.</li>
            </ol>
          </section>

          <section>
            <h2 class="text-lg font-bold">Rationale</h2>
            <p class="mt-3 text-slate-700 dark:text-slate-200">
              GitLab enforcement must match our GitHub posture so teams can move between platforms without policy gaps. Protected branches, approval rules, and required pipelines create the same traceability and auditability needed for regulated releases.
            </p>
          </section>
        </section>

        <footer class="mt-10 border-t border-slate-200 pt-6 text-sm text-slate-500 dark:border-slate-800 dark:text-slate-400">
          <div class="flex flex-wrap items-center justify-between gap-3">
            <div>Â© Internal â€” Git Operating Model</div>
            <div>Doc version: <span class="font-semibold">0.1</span></div>
          </div>
        </footer>
      </article>
    </main>
  </div>
</div>

<script src="../assets/site.js"></script>
</body>
</html>
